---
// LAYOUTS
import Layout from '../layouts/Layout.astro';
import Components from '../layouts/Components.astro';

// TYPES
import type { AvailableLanguages, AvailableLocales } from '../types/language';

// LANGUAGE COOKIE
const cookieLanguage: AvailableLanguages = Astro.cookies.get('language')
  ?.value as AvailableLanguages;
console.log('cookieLanguage:', cookieLanguage);

// LANGUAGE HEADER
const acceptedLanguage = Astro.request.headers
  .get('Accept-Language')
  ?.split('-')[0]
  ?.split(',')[0]
  .toUpperCase() as AvailableLanguages;
console.log('acceptLanguage:', acceptedLanguage);

// LANGUAGE
let language: AvailableLanguages = 'ES';
if (cookieLanguage) {
  language = cookieLanguage || 'ES';
} else {
  language = (acceptedLanguage as AvailableLanguages) || 'ES';
  Astro.cookies.set('language', language, {
    maxAge: 60 * 60 * 24 * 365,
    path: '/',
  });
}
console.log('language:', language);

// LOCALE
import { getLocale } from 'src/locales/getLocale';
const locale: AvailableLocales = getLocale(language);
---

<Layout language={language} locale={locale}>
  <Components language={language} locale={locale} />
</Layout>
